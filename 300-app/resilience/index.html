
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A workshop for Operations and Development teams on ARO.">
      
      
        <meta name="author" content="Red Hat">
      
      
        <link rel="canonical" href="https://ws.mobb.cloud/300-app/resilience/">
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.9">
    
    
      
        <title>Make an App Resilient - ARO Workshop</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.08040f6c.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Overpass:300,300i,400,400i,700,700i%7COverpass+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Overpass";--md-code-font:"Overpass Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-G42MP6ET81"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-G42MP6ET81",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-G42MP6ET81",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="red">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deploy-an-application" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ARO Workshop" class="md-header__button md-logo" aria-label="ARO Workshop" data-md-component="logo">
      
  <img src="../../favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ARO Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Make an App Resilient
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/rh-mobb/aro-workshop-content" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    rh-mobb/aro-workshop-content
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ARO Workshop" class="md-nav__button md-logo" aria-label="ARO Workshop" data-md-component="logo">
      
  <img src="../../favicon.ico" alt="logo">

    </a>
    ARO Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rh-mobb/aro-workshop-content" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    rh-mobb/aro-workshop-content
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../100-setup/1-environment/" class="md-nav__link">
        Environment Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../100-setup/2-cluster-creation/" class="md-nav__link">
        Create ARO Cluster
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../100-setup/3-access-cluster/" class="md-nav__link">
        Access Your Cluster
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Day Two ARO Operations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day Two ARO Operations" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Day Two ARO Operations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../200-ops/idp/aad/" class="md-nav__link">
        Configuring cluster authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../200-ops/day2/upgrades/" class="md-nav__link">
        Managing Cluster Upgrades
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../200-ops/day2/scaling-nodes/" class="md-nav__link">
        Managing Worker Nodes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../200-ops/day2/autoscaling/" class="md-nav__link">
        Cluster Autoscaling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../200-ops/day2/labels/" class="md-nav__link">
        Labeling Nodes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../200-ops/day2/observability/" class="md-nav__link">
        Forward Metrics and Logs to Azure Files
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Deploy and Expose an App
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deploy and Expose an App" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Deploy and Expose an App
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deploy/" class="md-nav__link">
        Deploy the App
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gitops/" class="md-nav__link">
        Using OpenShift GitOps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../networkpolicy/" class="md-nav__link">
        Restrict Network Access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pipelines/" class="md-nav__link">
        Automate Deploying the App with Tekton
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Make an App Resilient
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Make an App Resilient
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-an-application" class="md-nav__link">
    Deploy an application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod-disruption-budget" class="md-nav__link">
    Pod Disruption Budget
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#horizontal-pod-autoscaler-hpa" class="md-nav__link">
    Horizontal Pod Autoscaler (HPA)
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Service Mesh
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Service Mesh" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Service Mesh
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../500-service-mesh/introduction/" class="md-nav__link">
        Service Mesh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../500-service-mesh/install/" class="md-nav__link">
        Deploy Service Mesh Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../500-service-mesh/deploy-control-plane/" class="md-nav__link">
        Deploy Control Plane
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../500-service-mesh/deploy-workload/" class="md-nav__link">
        Deploy Workloads
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../500-service-mesh/weighted-routing/" class="md-nav__link">
        Deploy Weighted Load Balancing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../500-service-mesh/kiali/" class="md-nav__link">
        Access Kiali Dashboard
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Conclusion
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Conclusion" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Conclusion
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../finish/" class="md-nav__link">
        Clean Up
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-an-application" class="md-nav__link">
    Deploy an application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod-disruption-budget" class="md-nav__link">
    Pod Disruption Budget
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#horizontal-pod-autoscaler-hpa" class="md-nav__link">
    Horizontal Pod Autoscaler (HPA)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/rh-mobb/aro-workshop-content/edit/master/docs/300-app/resilience.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>Make an App Resilient</h1>

<p>In this section of the workshop, we will deploy an application to an ARO cluster, ensure the application is resilient to node failure, and scale the application when under load.</p>
<h2 id="deploy-an-application">Deploy an application<a class="headerlink" href="#deploy-an-application" title="Permanent link">#</a></h2>
<ol>
<li>
<p>First, let's deploy an application. To do so, run the following set of commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>oc new-project resilience-ex
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>oc -n resilience-ex new-app https://github.com/rh-mobb/frontend-js.git --name frontend-js
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>oc -n resilience-ex expose svc frontend-js
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>oc -n resilience-ex <span class="nb">set</span> resources deployment/frontend-js <span class="se">\</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>  --limits<span class="o">=</span><span class="nv">cpu</span><span class="o">=</span>60m,memory<span class="o">=</span>150Mi <span class="se">\</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>  --requests<span class="o">=</span><span class="nv">cpu</span><span class="o">=</span>50m,memory<span class="o">=</span>100Mi
</code></pre></div>
</li>
<li>
<p>While the application is being built from source, you can watch the rollout status of the deployment object to see when its finished.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>oc rollout status deploy/frontend-js
</code></pre></div>
</li>
<li>
<p>We can now use the route to view the application in your web browser. To get the route, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>oc -n resilience-ex get route frontend-js <span class="se">\</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>  -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;http://{.spec.host}{&quot;\n&quot;}&#39;</span>
</code></pre></div>
<p>Then visit the URL presented in a new tab in your web browser (using HTTP). For example, your output will look something similar to:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>frontend-js-resilience-ex.apps.ce7l3kf6.eastus.aroapp.io
</code></pre></div>
<p>In that case, you'd visit <code>http://frontend-js-resilience-ex.apps.ce7l3kf6.eastus.aroapp.io</code> in your browser.</p>
</li>
<li>
<p>Initially, this application is deployed with only one pod. In the event a worker node goes down or the pod crashes, there will be an outage of the application. To prevent that, let's scale the number of instances of our applications up to three. To do so, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>oc -n resilience-ex scale deployment <span class="se">\</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>  frontend-js --replicas<span class="o">=</span><span class="m">3</span>
</code></pre></div>
</li>
<li>
<p>Next, check to see that the application has scaled. To do so, run the following command to see the pods.
Then check that it has scaled</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>oc -n resilience-ex get pods <span class="se">\</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>  -l <span class="nv">deployment</span><span class="o">=</span>frontend-js
</code></pre></div>
<p>Your output should look similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>NAME                           READY   STATUS      RESTARTS   AGE
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>frontend-js-7cdc846c94-5mrk8   <span class="m">1</span>/1     Running     <span class="m">0</span>          3m45s
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>frontend-js-7cdc846c94-bj4wq   <span class="m">1</span>/1     Running     <span class="m">0</span>          3m45s
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>frontend-js-7cdc846c94-gjxv6   <span class="m">1</span>/1     Running     <span class="m">0</span>          4m39s
</code></pre></div>
</li>
</ol>
<h2 id="pod-disruption-budget">Pod Disruption Budget<a class="headerlink" href="#pod-disruption-budget" title="Permanent link">#</a></h2>
<p>A Pod disruption Budget (PBD) allows you to limit the disruption to your application when its pods need to be rescheduled for upgrades or routine maintenance work on ARO nodes. In essence, it lets developers define the minimum tolerable operational requirements for a deployment so that it remains stable even during a disruption.</p>
<p>For example, frontend-js deployed as part of the last step contains three replicas distributed evenly across three nodes. We can tolerate losing two pods but not three, so we create a PDB that requires a minimum of one replica.</p>
<p>A PodDisruptionBudget objectâ€™s configuration consists of the following key parts:</p>
<ul>
<li>A label selector, which is a label query over a set of pods.</li>
<li>An availability level, which specifies the minimum number of pods that must be available simultaneously, either:</li>
<li>minAvailable is the number of pods must always be available, even during a disruption.</li>
<li>maxUnavailable is the number of pods can be unavailable during a disruption.</li>
</ul>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>A maxUnavailable of 0% or 0 or a minAvailable of 100% or equal to the number of replicas can be used but will block nodes from being drained and can result in application instability during maintenance activities.</p>
</div>
<ol>
<li>
<p>Let's create a Pod Disruption Budget for our <code>frontend-js</code> application. To do so, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>cat <span class="s">&lt;&lt;EOF | oc apply -f -</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="s">apiVersion: policy/v1</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="s">kind: PodDisruptionBudget</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="s">metadata:</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="s">  name: frontend-js-pdb</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="s">  namespace: resilience-ex</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="s">spec:</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="s">  minAvailable: 1</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="s">  selector:</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="s">    matchLabels:</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="s">      deployment: frontend-js</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="s">EOF</span>
</code></pre></div>
<p>After creating the PDB, OpenShift API will ensure at least one pod of <code>frontend-js</code> is running all the time, even when maintenance is going on with the cluster.</p>
</li>
<li>
<p>Next, let's check the status of Pod Disruption Budget. To do so, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>oc -n resilience-ex get poddisruptionbudgets
</code></pre></div>
<p>Your output should match this:</p>
<div class="no-copy highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>NAME              MIN AVAILABLE   MAX UNAVAILABLE   ALLOWED DISRUPTIONS   AGE
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>frontend-js-pdb   1               N/A               2                     7m39s
</code></pre></div>
</li>
</ol>
<h2 id="horizontal-pod-autoscaler-hpa">Horizontal Pod Autoscaler (HPA)<a class="headerlink" href="#horizontal-pod-autoscaler-hpa" title="Permanent link">#</a></h2>
<p>As a developer, you can use a horizontal pod autoscaler (HPA) to specify how Azure Red Hat OpenShift clusters should automatically increase or decrease the scale of a replication controller or deployment configuration, based on metrics collected from the pods that belong to that replication controller or deployment configuration. You can create an HPA for any any deployment, replica set, replication controller, or stateful set.</p>
<p>In this exercise we will scale the <code>frontend-js</code> application based on CPU utilization:</p>
<ul>
<li>Scale out when average CPU utilization is greater than 50% of CPU limit</li>
<li>Maximum pods is 4</li>
<li>
<p>Scale down to min replicas if utilization is lower than threshold for 60 sec</p>
</li>
<li>
<p>First, we should create the HorizontalPodAutoscaler. To do so, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>cat &lt;&lt;EOF | oc apply -f -
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>apiVersion: autoscaling/v2
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>kind: HorizontalPodAutoscaler
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>metadata:
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>  name: frontend-js-cpu
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>  namespace: resilience-ex
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>spec:
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>  scaleTargetRef:
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    apiVersion: apps/v1
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    kind: Deployment
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>    name: frontend-js
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>  minReplicas: 2
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>  maxReplicas: 4
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>  metrics:
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    - type: Resource
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>      resource:
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>        name: cpu
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>        target:
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>          averageUtilization: 50
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>          type: Utilization
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>  behavior:
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>    scaleDown:
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>      stabilizationWindowSeconds: 60
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>      policies:
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>      - type: Percent
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>        value: 100
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>        periodSeconds: 15
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>EOF
</code></pre></div>
</li>
<li>
<p>Next, check the status of the HPA. To do so, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>oc -n resilience-ex get horizontalpodautoscaler/frontend-js-cpu
</code></pre></div>
<p>Your output should match the following:</p>
<div class="no-copy highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>NAME              REFERENCE                TARGETS         MINPODS   MAXPODS   REPLICAS   AGE
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>frontend-js-cpu   Deployment/frontend-js   0%/50%   2         4         3          45s
</code></pre></div>
</li>
<li>
<p>Next, let's generate some load against the <code>frontend-js</code> application. To do so, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>FRONTEND_URL=http://$(oc -n resilience-ex get route frontend-js -o jsonpath=&#39;{.spec.host}&#39;)
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>siege -c 60 $FRONTEND_URL
</code></pre></div>
</li>
<li>
<p>Wait for a minute and then kill the siege command (by hitting CTRL and c on your keyboard). Then immediately check the status of Horizontal Pod Autoscaler. To do so, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>oc -n resilience-ex get horizontalpodautoscaler/frontend-js-cpu
</code></pre></div>
<p>Your output should look similar to this:</p>
<div class="no-copy highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>NAME              REFERENCE                TARGETS    MINPODS   MAXPODS   REPLICAS   AGE
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>frontend-js-cpu   Deployment/frontend-js   113%/50%   2         4         4          3m13s
</code></pre></div>
<p>This means you are now running 4 replicas, instead of the original three that we started with.</p>
</li>
<li>
<p>Once you've killed the seige command, the traffic going to <code>frontend-js</code> service will cool down and after a 60 second cool down period, your application's replica count will drop back down to two. To demonstrate this, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>oc -n resilience-ex get horizontalpodautoscaler/frontend-js-cpu --watch
</code></pre></div>
<p>After a minute or two, your output should be similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>NAME              REFERENCE                TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>frontend-js-cpu   Deployment/frontend-js   <span class="m">10</span>%/50%   <span class="m">2</span>         <span class="m">4</span>         <span class="m">4</span>          6m55s
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>frontend-js-cpu   Deployment/frontend-js   <span class="m">8</span>%/50%    <span class="m">2</span>         <span class="m">4</span>         <span class="m">4</span>          7m1s
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>frontend-js-cpu   Deployment/frontend-js   <span class="m">8</span>%/50%    <span class="m">2</span>         <span class="m">4</span>         <span class="m">3</span>          7m16s
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>frontend-js-cpu   Deployment/frontend-js   <span class="m">0</span>%/50%    <span class="m">2</span>         <span class="m">4</span>         <span class="m">2</span>          7m31s
</code></pre></div>
</li>
</ul>


  




                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../pipelines/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Automate Deploying the App with Tekton" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Automate Deploying the App with Tekton
            </div>
          </div>
        </a>
      
      
        
        <a href="../../500-service-mesh/introduction/" class="md-footer__link md-footer__link--next" aria-label="Next: Service Mesh" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Service Mesh
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>